      SUBROUTINE CHDIAG (NM,N,AR,AI,W,ZR,ZI,FV1,FV2,FM1,IERR)
C
      IMPLICIT REAL*8 (A-H, O-Z)
C
C     DIAGONALIZE COMPLEX,HERMITIAN MATRIX BY CALLING APPROPRIATE LIBRARY
C
C     1) CALL EISPACK LIBRARY
C     2) CALL NAG MARK 16 LIBRARY
C
C     AR, AI  : MATRIX TO BE DIAGONALIZED ON INPUT; EIGENVECTORS ON OUTPUT
C     ZR, ZI  : WORKING SPACE
C     W       : EIGENVALUES
C     FV1,FM1 : WORKING SPACE
C
      DIMENSION AR(NM,NM),AI(NM,NM),W(NM),ZR(NM,NM),ZI(NM,NM)
      DIMENSION FV1(NM),FM1(NM)
C
      PARAMETER (ILIB = 2)
      IF (ILIB.EQ.1) THEN
         CALL CH (NM,N,AR,AI,W,1,ZR,ZI,FV1,FV2,FM1,IERR)
         DO 10 I = 1, N
         DO 10 J = 1, N
         AR(I,J) = ZR(I,J)
         AI(I,J) = ZI(I,J)
   10    CONTINUE
      ELSEIF (ILIB.EQ.2) THEN
C        TOL = X02ADF ()
C        IN MARK 14 NAG TOL IS NO LONGER REALLY USED
         TOL = 0.D0
         EPS = X02AJF ()
         CALL F01BCF (N,TOL,AR,NM,AI,NM,W,FV1,ZR,ZI)
         CALL F02AYF (N,EPS,W,FV1,AR,NM,AI,NM,IERR)
      ENDIF
      RETURN
      END
