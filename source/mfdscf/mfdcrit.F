C
C     ==================
      SUBROUTINE MFDCRIT
C     ==================
      IMPLICIT REAL*8 (A-H, O-Z)
C
C     CHECK CRITERIA FOR ENDING THE SCF CYCLES
C     1- VECTOR(N-1)/VECTOR(N) CONVERGENCE/DIVERGENCE
C     2- ENERGY(N-1)/ENERGY(N) CONVERGENCE/DIVERGENCE
C     3- ONLY DIAGONALISATION OF ONE-ELECTRON MATRIX REQUESTED
C     4- MAXIMUM NUMBER OF REQUESTED SCF-CYCLES EXCEEDED
C
      INCLUDE 'paracom.inc'
      INCLUDE 'general.inc'
C
      CHARACTER*14 WARNING,TEXT1*40,TEXT4*42
      CHARACTER*10 DATEX,THEDAT,THETIM*8
      DATA WARNING,TEXT1,TEXT4
     $     /' ** WARNING : ','NO CONVERGENCE TESTED/ONLYONE OPTION SET',
     $      'NO CONVERGENCE YET/MAX SCF CYCLES EXCEEDED'/
C
      LENREC=8 * MAX0(4*(NL+NS)+4,80)
      OPEN(MFDVECB,FILE=FNAM(2),ACCESS='DIRECT',
     +     RECL=LENREC)
      CALL DAYTIME (DATEX,THETIM)
      IF (DATEX.NE.DATUM) THEN
          DATUM=DATEX
          WRITE(DAYFTXT,1030) DATUM
      ENDIF
#if defined (BIT64)
      TOTDIF=ABS(EPREV-ETOTAL)
#else
      TOTDIF=DABS(EPREV-ETOTAL)
#endif
      WRITE (*,1010) ICYCLS,WDIF,EMDIF,TOTDIF,ETOTAL
      THEDAT = DATUM
      WRITE (MFDVECB,REC=1) MAX0(4*(NL+NS)+4,80),THEDAT,THETIM,ICYCLS,
     $                      KCYCLS,ETOTAL,EPREV,EMDIF,WDIF,TOTDIF
      CLOSE (MFDVECB)
      WDIFP=WDIF
      EMDIF=0.0D0
      WDIF =0.0D0
      IF (KCYCLS.GT.NCYCLS) ENDRUN=.TRUE.
      RETURN
 1000 FORMAT(//A,A//)
 1010 FORMAT(//' ITERATION',I4,' VECT DIF',G14.8,' ORB EN DIF',
     $G14.8,' EN DIF',G15.9,' TOT EN',G16.9)
 1030 FORMAT('TODAY IS ',A10)
      END
