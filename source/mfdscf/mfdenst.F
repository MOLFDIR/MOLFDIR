C
C     ==================
      SUBROUTINE MFDENST(DAAR,DBAR,DAAI,DBAI,FAAR,FAAI,
     +                   DOAAR,DOBAR,DOAAI,DOBAI,FOAAR,FOAAI,
     +                   DOACR,DOBCR,DOACI,DOBCI,FOACR,FOACI)
C     ==================
      IMPLICIT REAL*8 (A-H, O-Z)
C
C     TRANSFORM THE DENSITY BACK TO THE NON SYMMETRY ADAPTED BASIS
C
      INCLUDE 'paracom.inc'
      INCLUDE 'general.inc'
C
      REAL*8 DAAR(*),DBAR(*),DAAI(*),DBAI(*),FAAR(*),FAAI(*)
      REAL*8 DOAAR(*),DOBAR(*),DOAAI(*),DOBAI(*),FOAAR(*),FOAAI(*)
      REAL*8 DOACR(*),DOBCR(*),DOACI(*),DOBCI(*),FOACR(*),FOACI(*)
C
      OPEN (MFDENSM, FILE='MFDENSM', FORM='UNFORMATTED',
     +      ACCESS='DIRECT',RECL=16 * LREC)
C
C === READ IN THE DENSITY MATRIX IN THE SYMMETRY ADAPTED BASIS
      ICTC = 1
      ICTO1 = 1
      ICTO2 = 1
      DO 10 IRP = 1, NSYMRP
      NBS = NBSIM (IRP) * (NBSIM (IRP) + 1) / 2
      IF (NCL(IRP) .NE. 0) THEN
        CALL RSDENS(IRECDC,FAAR(ICTC),FAAI(ICTC),NBS,IRP,1)
        ICTC = ICTC + NBS
      ENDIF
      IF (NOP(IRP,1) .NE. 0) THEN
        CALL RSDENS(IRECDC,FOAAR(ICTO1),FOAAI(ICTO1),NBS,IRP,2)
        ICTO1 = ICTO1 + NBS
      ENDIF
      IF (NOP(IRP,2) .NE. 0) THEN
        CALL RSDENS(IRECDC,FOACR(ICTO2),FOACI(ICTO2),NBS,IRP,3)
        ICTO2 = ICTO2 + NBS
      ENDIF
   10 CONTINUE
C
C === NOW WE CAN DO THE ACTUAL TRANSFORMATION
C
      CALL DENST (DAAR,DBAR,DAAI,DBAI,FAAR,FAAI,1)
      IF (OPENSH) THEN
	 CALL DENST (DOAAR,DOBAR,DOAAI,DOBAI,FOAAR,FOAAI,2)
	 IF (NOPEN.GT.1)
     +     CALL DENST (DOACR,DOBCR,DOACI,DOBCI,FOACR,FOACI,3)
      ENDIF
      CLOSE(MFDENSM)
      RETURN
      END
